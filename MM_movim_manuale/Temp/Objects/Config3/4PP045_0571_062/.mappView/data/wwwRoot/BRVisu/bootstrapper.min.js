(function(){"use strict";function s(t,r,u){if(r===!0){var f;try{f=JSON.parse(t)}catch(e){n.showUserMessage("error in configuration file");return}f!==undefined&&f.status&&f.status.code===0&&(Object.defineProperty(window.brease.preloaded,"configuration",{enumerable:!0,configurable:!0,writable:!1,value:f.configuration}),f!==undefined&&f.configuration&&f.configuration.defaultVisu&&(n.defaultVisu=f.configuration.defaultVisu.toLowerCase()))}else n.showUserMessage("loading configuration: "+u);ft(n.params.visuid)?i():h()}function h(){u("/services/server/getRedirectConfig",function(t){var r=n.getRules(t);r==="noRules"?n.defaultVisu===undefined?(n.showUserMessage("no rules in redirect configuration are specified and no default visualization is found"),n.logger(-2134803120,0,"",["noConfig"],"no rules in redirect configuration are specified and no default visualization is found")):(n.params.visuid=n.defaultVisu?n.defaultVisu.toLowerCase():n.defaultVisu,i()):r==="error"?n.showUserMessage("error in rules file redirect.json"):r==="noConfigurations"?(n.params.visuid===undefined&&(n.params.visuid=n.defaultVisu?n.defaultVisu.toLowerCase():n.defaultVisu),i()):it(r,c)})}function c(t){t.find(function(t){return t.visuid===n.params.visuid})!==undefined?i():t[0]!==undefined?n.params.visuid!==undefined&&n.params.visuid!==n.defaultVisu?n.logger(-2134803126,0,"",[n.params.visuid],'the requested visualization "'+n.params.visuid+'" was blocked due to configured redirect rules',function(){r(t[0].visuid,t[0].name)}):r(t[0].visuid,t[0].name):n.defaultVisu!==undefined?n.params.visuid!==undefined&&n.params.visuid!==n.defaultVisu?n.logger(-2134803126,0,"",[n.params.visuid],'the requested visualization "'+n.params.visuid+'" was blocked due to configured redirect rules',function(){r(n.defaultVisu)}):r(n.defaultVisu):n.params.visuid===undefined?n.showUserMessage("no visuId specified"):n.showUserMessage('the requested visualization "'+n.params.visuid+'" was blocked due to configured redirect rules')}function r(t,r){r===undefined?console.log("redirect client to default visualization:"+t):console.log('redirect client to visualization "'+t+'" due to rule:'+r);n.params.visuid=t;i()}function i(){if(n.params.visuid===undefined){n.showUserMessage("no visuId specified");return}n.params.visuid=n.params.visuid.toLowerCase();document.title="Visualization "+n.params.visuid;l(n.params.visuid)}function l(t){u("/"+t+".json",function(i,r,u){if(r===!0){var f;try{f=JSON.parse(i)}catch(e){n.showUserMessage("error in visu file "+t+".json");return}f.id=t;Object.defineProperty(window.brease.preloaded,"visu",{enumerable:!0,configurable:!0,writable:!1,value:f});n.visuStarter(f)}else n.showUserMessage('loading visu with id "'+t+'" failed: '+u)})}function a(n){var t=n.configurations;p(t);w(t,function(n,i){k(t,n,i);g();v()})}function v(){n.params.debug==="true"?n.scriptLoader({src:"libs/require.js","data-main":"require_config"},o):n.scriptLoader({src:"release/brease.js"},o)}function y(){var t={warn:n.params.clientwarnings!==undefined&&n.params.clientwarnings.toLowerCase()==="true",editMode:n.params.editmode!==undefined&&n.params.editmode.toLowerCase()==="true",detection:{mobile:tt(),os:platform.os.family,browser:platform.name},watchdog:n.params.watchdog!==undefined?parseInt(n.params.watchdog,10):undefined,storageLog:n.params.storagelog!==undefined&&n.params.storagelog.toLowerCase()==="true"};return t.detection.ios=platform&&platform.os&&platform.os.family?platform.os.family.toLowerCase()==="ios":navigator.platform.search(/(iphone|ipod|ipad)/gi)!==-1,t}function o(){var i=y(),t;if(d(i.storageLog),n.params.monitor==="true"&&document.location.href.indexOf("monitor.html")===-1){document.location.href="/BRVisu/assets/monitor/monitor.html"+document.location.search;return}n.scriptExecutor('require(["brease/application"], function (application) {application.startVisu("'+n.params.visuid+'",'+JSON.stringify(i)+");});");t=document.getElementById("bootstrapper");t&&document.body.removeChild(t)}function u(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0);i.setRequestHeader("Content-Type","application/json");i.setRequestHeader("Accept","*/*");i.onreadystatechange=function(){var n=parseInt(i.status,10);i.readyState===XMLHttpRequest.DONE&&(n===e.OK?t(i.responseText,!0):n===e.NOT_FOUND?t("",!1,"not found"):t("",!1,"could not load file"))};i.ontimeout=function(){t("",!1,"timed out")};i.send(null)}function p(i){var r=i&&i.favicon?i.favicon:n.favicon,u="image/x-icon";r.lastIndexOf(".gif")>0?u="image/gif":r.lastIndexOf(".png")>0&&(u="image/png");t("link",{href:r,rel:"icon",type:u},document.head)}function w(t,i){var u=t&&t.bootLogo?t.bootLogo:n.bootLogo,r=new Image;r.onload=function(){i(!0,r)};r.onerror=function(){i(!1)};r.src=u}function b(n){var t=document.getElementById("appContainer");t.textContent=n;t.style.fontSize="22px"}function k(i,r,u){var s=i&&i.bootLogo?i.bootLogo:n.bootLogo,o=i&&i.bootColor?i.bootColor:n.bootColor,e=document.getElementById("splashscreen"),f;e&&(f=e.style,f.position="fixed",f.top="0",f.left="0",f.width="100%",f.height="100%",f.zIndex="2",r===!0?(f.background=o+" url("+u.src+") no-repeat 50% 50%",(u.width>window.innerWidth||u.height>window.innerHeight)&&(f.backgroundSize="contain")):(f.backgroundColor=o,f.display="inline-flex",f.flexDirection="column",f.flexWrap="nowrap",f.justifyContent="center",f.alignContent="center",f.alignItems="center",t("div",{style:"display:inline-box;width:50%;background-color:white;color:black;font-size:18px;line-height:18px;text-align:center;padding:12px 0;flex:0 0 auto;"},e,"boot image not found: "+s),t("img",{src:n.bootLogo,style:"margin:12px 0;flex:0 0 auto;"},e)))}function d(n){n===!0&&t("a",{href:"/BRVisu/assets/log.html?t="+Date.now(),style:"position:fixed;top:5px;left:5px;font-size:18px;line-height:18px;z-index:9;"},document.body,"log")}function g(){nt(n.visuStyle)===undefined&&t("link",{rel:"stylesheet",href:n.visuStyle},document.head)}function t(n,t,i,r){var u=document.createElement(n);for(var f in t)u.setAttribute(f,t[f]);r!==undefined&&(u.textContent=r);i.appendChild(u)}function nt(n){var i,t;if(n!=="")for(t=0;t<document.styleSheets.length;t+=1)if(document.styleSheets[t].href&&document.styleSheets[t].href.indexOf(n)!==-1){i=document.styleSheets[t];break}return i}function tt(){var n=!1,t=!1,i=navigator.userAgent,r=i||navigator.vendor||window.opera;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4)))&&(n=!0),(/(tablet|ipad|playbook|silk)|(android(?!.*mobile))/i.test(i)||navigator.platform.toLowerCase().indexOf("ipad")!==-1)&&(t=!0),n||t}function f(n){this.tmpipaddress=this.convert(n)}function it(t,i){n.getClientInfo(function(r){var u=n.interpretClientRules(t,r);typeof i=="function"&&i(u)})}function rt(n){var t=new XMLHttpRequest,i=window.location.protocol+"//"+window.location.hostname+":"+window.location.port+"/client/getIp";t.onreadystatechange=function(){this.readyState===4&&this.status===200&&typeof n=="function"&&n(JSON.parse(this.responseText).ip)};t.open("GET",i,!0);t.setRequestHeader("Content-Type","application/json; charset=utf-8");t.setRequestHeader("Cache-Control","no-cache");t.setRequestHeader("Accept","*/*");t.send(null)}function ut(n,t){var i=Math.pow(10,t);return Math.round(i*n)/i}function ft(n){return typeof n=="string"&&n.indexOf("mapp")===0}function et(n,t,i,r,u,f){u&&console.log(u);var e=new XMLHttpRequest,s=[{eventId:n,verboseLvl:t,text:i||"",args:r}],o="",h=window.location.protocol+"//"+window.location.hostname+":"+window.location.port+"/services/server/sendEventLog";try{o=JSON.stringify({Data:s})}catch(c){return}e.onreadystatechange=function(){this.readyState===4&&typeof f=="function"&&f()};e.open("POST",h,!0);e.setRequestHeader("Content-Type","application/json; charset=utf-8");e.setRequestHeader("Cache-Control","no-cache");e.setRequestHeader("Accept","*/*");e.send(o)}var n={favicon:"/favicon.ico",bootLogo:"/BRVisu/assets/img/br_logo.png",bootColor:"#FF8800",visuStyle:"/BRVisu/release/brease_core.min.css",defaultVisu:undefined,start:function(t,i,r,f,e,o){n.visuStarter=typeof t=="function"?t:a;n.showUserMessage=typeof i=="function"?i:b;typeof r=="function"&&(n.urlParser=r);n.logger=typeof f=="function"?f:et;typeof e=="function"&&(n.scriptLoader=e);typeof o=="function"&&(n.scriptExecutor=o);window.brease||(window.brease={});window.brease.preloaded={};n.defaultVisu=undefined;n.params=n.urlParser(window.location.pathname,window.location.search);u("/services/server/getConfiguration",s)},getClientInfo:function(n){var t={hostname:document.location.hostname?document.location.hostname:"",browser:platform.name?platform.name:"",operatingsystem:platform.os.family?platform.os.family:"",aspectratio:screen.width&&screen.height?ut(screen.width/screen.height,2):1,orientation:window.matchMedia("(orientation: landscape)").matches?"landscape":"portrait",displaywidth:screen.width?screen.width:0,displayheight:screen.height?screen.height:0};rt(function(i){var r=i?""+i:"";t.ipaddress=new f(r);typeof n=="function"&&n(t)})},interpretClientRules:function(n,t){return n.filter(function(actRule){var ipaddress=this.ipaddress,hostname=this.hostname,browser=this.browser,operatingsystem=this.operatingsystem,aspectratio=this.aspectratio,orientation=this.orientation,displaywidth=this.displaywidth,displayheight=this.displayheight;return eval(actRule.op)},t).map(function(n){return{name:n.name,visuid:n.visu.toLowerCase()}})},getRules:function(n){var r=[],t,u,i;if(typeof n=="string"&&n.length>0){try{u=JSON.parse(n)}catch(f){return"error"}t=u.redirectconfig}if(!t)return"noConfigurations";if(Object.getOwnPropertyNames(t).length===0)return"noRules";for(i in t)r.push({name:i,visu:t[i].visu,op:t[i].op});return r},urlParser:function(n,t){var u={},f,r,e,o,i;if(t.lastIndexOf("?")===0)for(t=t.substring(1),f=t.split("&"),r=0;r<f.length;r+=1)e=f[r],e.indexOf("=")!==-1&&(o=e.split("="),u[o[0].toLowerCase()]=o[1].toLowerCase());return i=n.substring(1),i!==""&&i.indexOf(".")===-1&&i.indexOf("/")===-1&&(u.visuid=i.toLowerCase()),u},scriptLoader:function(n,t){var i=document.createElement("script");for(var r in n)i.setAttribute(r,n[r]);i.readyState?i.onreadystatechange=function(){(i.readyState==="loaded"||i.readyState==="complete")&&(i.onreadystatechange=null,typeof t=="function"&&t())}:i.onload=function(){typeof t=="function"&&t();i.onload=null};document.body.appendChild(i)},scriptExecutor:function(n,i){var r={};i&&(r.id=i);t("script",r,document.body,n)}},e={OK:200,NOT_FOUND:404};f.prototype={ge:function(n){return this.gt(n)||this.eq(n)},le:function(n){return this.lt(n)||this.eq(n)},gt:function(n){for(var i=this.convert(n),t=0;t<i.length;t=t+1){if(this.tmpipaddress[t]>i[t])return!0;if(this.tmpipaddress[t]<i[t])break}return!1},lt:function(n){for(var i=this.convert(n),t=0;t<i.length;t=t+1){if(this.tmpipaddress[t]<i[t])return!0;if(this.tmpipaddress[t]>i[t])break}return!1},eq:function(n){for(var r=this.convert(n),i=!0,t=0;t<r.length;t=t+1)i=i&&this.tmpipaddress[t]===r[t];return i},neq:function(n){for(var i=this.convert(n),t=0;t<i.length;t=t+1)if(this.tmpipaddress[t]!==i[t])return!0;return!1},convert:function(n){return n.split(".").map(function(n){return parseInt(n,10)})}};typeof define=="function"&&define.amd?define("bootstrapper",[],function(){return n.Ipaddress=f,n}):n.start()})();